DeviceProcessEvents
| where TimeGenerated >= ago(30d)  // Adjust the time range as needed
| where FileName in ("rundll32.exe", "spoolsv.exe") 
| where ProcessCommandLine has_any ("PRINTUI.DLL", "RpcAddPrinterDriverEx", "AddPrinterDriver", "pwszDriverPath", "pwszDataFile", "pwszConfigFile")  // Suspicious PrintNightmare exploitation indicators
| project TimeGenerated, DeviceName, InitiatingProcessAccountName, FileName, ProcessCommandLine, InitiatingProcessFileName, InitiatingProcessParentFileName
| order by TimeGenerated desc
